<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .task-card {
            transition: all 0.2s ease;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .column {
            min-height: 400px;
        }
        .timer-display {
            font-family: 'Courier New', monospace;
        }
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-indigo-700">KanbanFlow</h1>
            <button id="createTaskBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center">
                <i class="fas fa-plus mr-2"></i> Criar Tarefa
            </button>
        </header>

        <!-- Kanban Board -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- To Do Column -->
            <div class="bg-gray-200 rounded-lg p-4 column">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700">A Fazer</h2>
                    <span class="bg-gray-300 text-gray-700 px-2 py-1 rounded-full text-xs font-medium" id="todo-count">0</span>
                </div>
                <div id="todo-tasks" class="space-y-3">
                    <!-- Tasks will be added here dynamically -->
                </div>
            </div>

            <!-- In Progress Column -->
            <div class="bg-gray-200 rounded-lg p-4 column">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700">Em Progresso</h2>
                    <span class="bg-blue-300 text-blue-700 px-2 py-1 rounded-full text-xs font-medium" id="progress-count">0</span>
                </div>
                <div id="progress-tasks" class="space-y-3">
                    <!-- Tasks will be added here dynamically -->
                </div>
            </div>

            <!-- Done Column -->
            <div class="bg-gray-200 rounded-lg p-4 column">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-700">Concluído</h2>
                    <span class="bg-green-300 text-green-700 px-2 py-1 rounded-full text-xs font-medium" id="done-count">0</span>
                </div>
                <div id="done-tasks" class="space-y-3">
                    <!-- Tasks will be added here dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-gray-800">Nova Tarefa</h3>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700" title="Fechar Modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <form id="taskForm">
                    <div class="mb-4">
                        <label for="taskTitle" class="block text-sm font-medium text-gray-700 mb-1">Título</label>
                        <input type="text" id="taskTitle" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500" required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="taskDescription" class="block text-sm font-medium text-gray-700 mb-1">Descrição</label>
                        <textarea id="taskDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label for="taskPriority" class="block text-sm font-medium text-gray-700 mb-1">Prioridade</label>
                        <select id="taskPriority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="low">Baixa</option>
                            <option value="medium">Média</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="enableTimer" class="rounded text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-sm text-gray-700">Adicionar timer</span>
                        </label>
                    </div>
                    
                    <div id="timerSection" class="mb-4 hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Tempo Estimado</label>
                        <div class="flex space-x-2">
                            <div class="flex-1">
                                <label class="block text-xs text-gray-500 mb-1">Horas</label>
                                <input type="number" id="hours" min="0" max="24" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md" title="Horas estimadas" placeholder="Horas">
                            </div>
                            <div class="flex-1">
                                <label class="block text-xs text-gray-500 mb-1">Minutos</label>
                                <input type="number" id="minutes" min="0" max="59" value="30" class="w-full px-3 py-2 border border-gray-300 rounded-md" title="Minutos estimados" placeholder="Minutos">
                            </div>
                            <div class="flex-1">
                                <label class="block text-xs text-gray-500 mb-1">Segundos</label>
                                <input type="number" id="seconds" min="0" max="59" value="0" class="w-full px-3 py-2 border border-gray-300 rounded-md" title="Segundos estimados" placeholder="Segundos">
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelTaskBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Cancelar</button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">Criar Tarefa</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div id="taskDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white rounded-lg w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="detailTitle" class="text-xl font-semibold text-gray-800"></h3>
                    <button id="closeDetailModalBtn" class="text-gray-500 hover:text-gray-700" title="Fechar Detalhes da Tarefa">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <p id="detailDescription" class="text-gray-700"></p>
                </div>
                
                <div class="mb-4">
                    <span id="detailPriority" class="inline-block px-2 py-1 text-xs font-medium rounded-full"></span>
                </div>
                
                <div id="timerDisplaySection" class="mb-4 hidden">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-gray-500 mr-2"></i>
                        <span id="timerDisplay" class="timer-display font-medium">00:30:00</span>
                    </div>
                    <div class="mt-2 flex space-x-2">
                        <button id="startTimerBtn" class="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600">
                            <i class="fas fa-play mr-1"></i> Iniciar
                        </button>
                        <button id="pauseTimerBtn" class="px-3 py-1 bg-yellow-500 text-white text-sm rounded hover:bg-yellow-600">
                            <i class="fas fa-pause mr-1"></i> Pausar
                        </button>
                        <button id="resetTimerBtn" class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">
                            <i class="fas fa-redo mr-1"></i> Reiniciar
                        </button>
                    </div>
                </div>
                
                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <div class="flex space-x-2">
                        <button id="moveToTodoBtn" class="px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300">
                            <i class="fas fa-undo mr-1"></i> A Fazer
                        </button>
                        <button id="moveToProgressBtn" class="px-3 py-1 bg-blue-200 text-blue-700 text-sm rounded hover:bg-blue-300">
                            <i class="fas fa-spinner mr-1"></i> Em Progresso
                        </button>
                        <button id="moveToDoneBtn" class="px-3 py-1 bg-green-200 text-green-700 text-sm rounded hover:bg-green-300">
                            <i class="fas fa-check mr-1"></i> Concluir
                        </button>
                    </div>
                    <button id="deleteTaskBtn" class="px-3 py-1 bg-red-100 text-red-700 text-sm rounded hover:bg-red-200">
                        <i class="fas fa-trash mr-1"></i> Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const createTaskBtn = document.getElementById('createTaskBtn');
        const taskModal = document.getElementById('taskModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelTaskBtn = document.getElementById('cancelTaskBtn');
        const taskForm = document.getElementById('taskForm');
        const enableTimer = document.getElementById('enableTimer');
        const timerSection = document.getElementById('timerSection');
        const taskDetailModal = document.getElementById('taskDetailModal');
        const closeDetailModalBtn = document.getElementById('closeDetailModalBtn');
        
        // Task columns
        const todoTasks = document.getElementById('todo-tasks');
        const progressTasks = document.getElementById('progress-tasks');
        const doneTasks = document.getElementById('done-tasks');
        
        // Count elements
        const todoCount = document.getElementById('todo-count');
        const progressCount = document.getElementById('progress-count');
        const doneCount = document.getElementById('done-count');
        
        // Timer variables
        let timerInterval;
        let currentTaskId = null;
        let timerRunning = false;
        let remainingTime = 0;
        
        // Sample tasks (would normally come from a database)
        let tasks = [
            {
                id: 1,
                title: "Projeto Kanban",
                description: "Criar um sistema de gerenciamento de tarefas estilo Kanban",
                priority: "high",
                status: "todo",
                timer: {
                    enabled: true,
                    hours: 0,
                    minutes: 30,
                    seconds: 0,
                    remaining: 1800 // 30 minutes in seconds
                }
            },
            {
                id: 2,
                title: "Reunião de equipe",
                description: "Discutir progresso do projeto atual",
                priority: "medium",
                status: "progress",
                timer: {
                    enabled: false
                }
            },
            {
                id: 3,
                title: "Documentação",
                description: "Escrever documentação do sistema",
                priority: "low",
                status: "done",
                timer: {
                    enabled: false
                }
            }
        ];
        
        // Initialize the board
        function initBoard() {
            renderTasks();
            updateCounts();
        }
        
        // Render all tasks
        function renderTasks() {
            // Clear all columns
            todoTasks.innerHTML = '';
            progressTasks.innerHTML = '';
            doneTasks.innerHTML = '';
            
            // Render each task in the appropriate column
            tasks.forEach(task => {
                const taskElement = createTaskElement(task);
                
                switch(task.status) {
                    case 'todo':
                        todoTasks.appendChild(taskElement);
                        break;
                    case 'progress':
                        progressTasks.appendChild(taskElement);
                        break;
                    case 'done':
                        doneTasks.appendChild(taskElement);
                        break;
                }
            });
        }
        
        // Create a task card element
        function createTaskElement(task) {
            const priorityClasses = {
                low: 'bg-green-100 text-green-800',
                medium: 'bg-yellow-100 text-yellow-800',
                high: 'bg-red-100 text-red-800'
            };
            
            const taskElement = document.createElement('div');
            taskElement.className = 'task-card bg-white p-4 rounded-lg shadow cursor-pointer';
            taskElement.dataset.id = task.id;
            
            taskElement.innerHTML = `
                <div class="flex justify-between items-start">
                    <h3 class="font-medium text-gray-800">${task.title}</h3>
                    <span class="text-xs px-2 py-1 rounded-full ${priorityClasses[task.priority]}">${getPriorityText(task.priority)}</span>
                </div>
                ${task.description ? `<p class="text-sm text-gray-600 mt-2">${task.description.substring(0, 60)}${task.description.length > 60 ? '...' : ''}</p>` : ''}
                ${task.timer.enabled ? `<div class="mt-3 flex items-center text-xs text-gray-500">
                    <i class="fas fa-clock mr-1"></i>
                    <span>${formatTime(task.timer.hours)}:${formatTime(task.timer.minutes)}:${formatTime(task.timer.seconds)}</span>
                </div>` : ''}
            `;
            
            taskElement.addEventListener('click', () => openTaskDetail(task.id));
            
            return taskElement;
        }
        
        // Format time to two digits
        function formatTime(time) {
            return time < 10 ? `0${time}` : time;
        }
        
        // Get priority text
        function getPriorityText(priority) {
            const priorityText = {
                low: 'Baixa',
                medium: 'Média',
                high: 'Alta'
            };
            return priorityText[priority];
        }
        
        // Update task counts
        function updateCounts() {
            const todo = tasks.filter(task => task.status === 'todo').length;
            const progress = tasks.filter(task => task.status === 'progress').length;
            const done = tasks.filter(task => task.status === 'done').length;
            
            todoCount.textContent = todo;
            progressCount.textContent = progress;
            doneCount.textContent = done;
        }
        
        // Open create task modal
        createTaskBtn.addEventListener('click', () => {
            taskModal.classList.remove('hidden');
        });
        
        // Close modals
        function closeModals() {
            taskModal.classList.add('hidden');
            taskDetailModal.classList.add('hidden');
            taskForm.reset();
            timerSection.classList.add('hidden');
            enableTimer.checked = false;
        }
        
        // Close modal buttons
        closeModalBtn.addEventListener('click', closeModals);
        cancelTaskBtn.addEventListener('click', closeModals);
        closeDetailModalBtn.addEventListener('click', closeModals);
        
        // Toggle timer section
        enableTimer.addEventListener('change', () => {
            if (enableTimer.checked) {
                timerSection.classList.remove('hidden');
            } else {
                timerSection.classList.add('hidden');
            }
        });
        
        // Handle form submission
        taskForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const priority = document.getElementById('taskPriority').value;
            const timerEnabled = enableTimer.checked;
            
            const newTask = {
                id: Date.now(), // Simple unique ID
                title,
                description,
                priority,
                status: 'todo',
                timer: {
                    enabled: timerEnabled
                }
            };
            
            if (timerEnabled) {
                const hours = parseInt(document.getElementById('hours').value) || 0;
                const minutes = parseInt(document.getElementById('minutes').value) || 0;
                const seconds = parseInt(document.getElementById('seconds').value) || 0;
                
                newTask.timer.hours = hours;
                newTask.timer.minutes = minutes;
                newTask.timer.seconds = seconds;
                newTask.timer.remaining = (hours * 3600) + (minutes * 60) + seconds;
            }
            
            tasks.push(newTask);
            renderTasks();
            updateCounts();
            closeModals();
        });
        
        // Open task detail modal
        function openTaskDetail(taskId) {
            const task = tasks.find(t => t.id == taskId);
            if (!task) return;
            
            currentTaskId = taskId;
            
            document.getElementById('detailTitle').textContent = task.title;
            document.getElementById('detailDescription').textContent = task.description || 'Sem descrição';
            
            const priorityElement = document.getElementById('detailPriority');
            priorityElement.textContent = getPriorityText(task.priority);
            priorityElement.className = 'inline-block px-2 py-1 text-xs font-medium rounded-full ' + 
                (task.priority === 'low' ? 'bg-green-100 text-green-800' : 
                 task.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800');
            
            const timerDisplaySection = document.getElementById('timerDisplaySection');
            if (task.timer.enabled) {
                timerDisplaySection.classList.remove('hidden');
                remainingTime = task.timer.remaining;
                updateTimerDisplay();
            } else {
                timerDisplaySection.classList.add('hidden');
            }
            
            taskDetailModal.classList.remove('hidden');
        }
        
        // Timer functions
        function updateTimerDisplay() {
            const hours = Math.floor(remainingTime / 3600);
            const minutes = Math.floor((remainingTime % 3600) / 60);
            const seconds = remainingTime % 60;
            
            document.getElementById('timerDisplay').textContent = 
                `${formatTime(hours)}:${formatTime(minutes)}:${formatTime(seconds)}`;
        }
        
        function startTimer() {
            if (timerRunning) return;
            
            timerRunning = true;
            timerInterval = setInterval(() => {
                if (remainingTime > 0) {
                    remainingTime--;
                    updateTimerDisplay();
                    
                    // Update the task's remaining time
                    const taskIndex = tasks.findIndex(t => t.id == currentTaskId);
                    if (taskIndex !== -1) {
                        tasks[taskIndex].timer.remaining = remainingTime;
                    }
                } else {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    alert('Tempo esgotado!');
                }
            }, 1000);
        }
        
        function pauseTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
        }
        
        function resetTimer() {
            pauseTimer();
            const task = tasks.find(t => t.id == currentTaskId);
            if (task && task.timer.enabled) {
                remainingTime = (task.timer.hours * 3600) + (task.timer.minutes * 60) + task.timer.seconds;
                task.timer.remaining = remainingTime;
                updateTimerDisplay();
            }
        }
        
        // Timer buttons
        document.getElementById('startTimerBtn').addEventListener('click', startTimer);
        document.getElementById('pauseTimerBtn').addEventListener('click', pauseTimer);
        document.getElementById('resetTimerBtn').addEventListener('click', resetTimer);
        
        // Task movement buttons
        function moveTaskToStatus(status) {
            const taskIndex = tasks.findIndex(t => t.id == currentTaskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].status = status;
                renderTasks();
                updateCounts();
                closeModals();
            }
        }
        
        document.getElementById('moveToTodoBtn').addEventListener('click', () => moveTaskToStatus('todo'));
        document.getElementById('moveToProgressBtn').addEventListener('click', () => moveTaskToStatus('progress'));
        document.getElementById('moveToDoneBtn').addEventListener('click', () => moveTaskToStatus('done'));
        
        // Delete task
        document.getElementById('deleteTaskBtn').addEventListener('click', () => {
            if (confirm('Tem certeza que deseja excluir esta tarefa?')) {
                tasks = tasks.filter(t => t.id != currentTaskId);
                renderTasks();
                updateCounts();
                closeModals();
            }
        });
        
        // Initialize the board
        initBoard();
    </script>
</body>
</html>